{% extends "base.html" %}

{% block title %}{{ pilot.callsign }} - –ü—Ä–æ—Ñ—ñ–ª—å –ø—ñ–ª–æ—Ç–∞{% endblock %}

{% block content %}
<section class="pilot-profile">
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ—ñ–ª—é -->
        <div class="pilot-header">
            <img src="{{ url_for('static', filename='images/' + pilot.photo_url) }}" 
                 alt="{{ pilot.callsign }}" 
                 class="pilot-avatar"
                 onerror="this.src='{{ url_for('static', filename='images/default-pilot.svg') }}'">
            <div class="pilot-info">
                <h1>{{ pilot.callsign }}</h1>
                <div class="pilot-meta">
                    {% if pilot.__tablename__ == 'participant' %}
                        <!-- –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ -->
                        {% set cat_info = pilot.get_category_info() %}
                        <span class="pilot-category participant-{{ pilot.category }}" style="color: {{ cat_info.get('color', '#ffffff') }};">
                            {{ cat_info.get('emoji', '') }} {{ cat_info.get('name', pilot.category) }}
                            {% if pilot.subcategory %}
                                <br><small>{{ pilot.get_subcategory_name() }}</small>
                            {% endif %}
                        </span>
                    {% else %}
                        <!-- –°—Ç–∞—Ä—ã–π –ø–∏–ª–æ—Ç -->
                        <span class="pilot-category category-{{ pilot.category }}">
                            {% if pilot.category == 'strike' %}üöÅ –£–¥–∞—Ä–Ω–∏–π –ø—ñ–ª–æ—Ç{% else %}üëÅÔ∏è –†–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω–∏–π –ø—ñ–ª–æ—Ç{% endif %}
                        </span>
                    {% endif %}
                </div>
                <div class="pilot-meta">
                    <strong>–î–∞—Ç–∞ –≤—Å—Ç—É–ø—É:</strong> {{ pilot.join_date.strftime('%d.%m.%Y') }}
                </div>
                {% if pilot.__tablename__ == 'participant' %}
                    {% if pilot.is_pilot() %}
                    <div class="pilot-points">{{ pilot.points }} –æ—á–æ–∫</div>
                    {% endif %}
                {% else %}
                    <div class="pilot-points">{{ pilot.points }} –æ—á–æ–∫</div>
                {% endif %}
            </div>
            
            <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π ID –∏ QR –∫–æ–¥ -->
            <div class="pilot-id-card {% if pilot.__tablename__ == 'participant' and not pilot.is_active %}inactive{% endif %}">
                <div class="id-info">
                    <div class="pilot-id-number">
                        {% if pilot.__tablename__ == 'participant' %}{{ pilot.participant_id }}{% else %}{{ pilot.pilot_id }}{% endif %}
                    </div>
                    <div class="id-status {% if pilot.__tablename__ == 'participant' and not pilot.is_active %}inactive{% endif %}">
                        {% if pilot.__tablename__ == 'participant' %}
                            {% if pilot.is_active %}ID –∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞{% else %}ID –∫–∞—Ä—Ç–∞ –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞{% endif %}
                        {% else %}
                            ID –∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
                        {% endif %}
                    </div>
                </div>
                <div class="qr-mini">
                    <iframe src="{{ url_for('generate_qr', qr_code=pilot.qr_code) }}" 
                            width="160" 
                            height="160" 
                            frameborder="0"
                            scrolling="no">
                    </iframe>
                </div>
            </div>
        </div>

        <!-- –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è -->
        <div class="achievements-section">
            <h2>–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</h2>
            {% if achievements %}
                <div class="achievements-list">
                    {% for achievement in achievements %}
                    <div class="achievement-item">
                        <div class="achievement-info">
                            <div class="achievement-description">{{ achievement.description }}</div>
                            <div class="achievement-date">{{ achievement.date_awarded.strftime('%d.%m.%Y') }}</div>
                        </div>
                        {% if pilot.__tablename__ == 'participant' %}
                            {% if pilot.is_pilot() and achievement.points > 0 %}
                            <div class="achievement-points">+{{ achievement.points }}</div>
                            {% endif %}
                        {% else %}
                            <div class="achievement-points">+{{ achievement.points }}</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-achievements">
                    <p>–ü–æ–∫–∏ —â–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
                </div>
            {% endif %}
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–∏–ª–æ—Ç–æ–≤) -->
        {% if pilot.__tablename__ == 'participant' %}
            {% if pilot.is_pilot() %}
            <div class="pilot-stats">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ pilot.points }}</div>
                        <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –æ—á–∫–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ achievements|length }}</div>
                        <div class="stat-label">–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            {% set rank = 1 %}
                            {% if pilot.subcategory == 'pilot_strike' %}
                                {% for p in all_strike_pilots %}
                                    {% if p.id == pilot.id %}{{ loop.index }}{% endif %}
                                {% endfor %}
                            {% else %}
                                {% for p in all_recon_pilots %}
                                    {% if p.id == pilot.id %}{{ loop.index }}{% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="stat-label">–ú—ñ—Å—Ü–µ –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ days_in_federation }}</div>
                        <div class="stat-label">–î–Ω—ñ–≤ —É —Ñ–µ–¥–µ—Ä–∞—Ü—ñ—ó</div>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- –î–ª—è –Ω–µ-–ø–∏–ª–æ—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é -->
            <div class="pilot-stats">
                <h2>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ achievements|length }}</div>
                        <div class="stat-label">–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ days_in_federation }}</div>
                        <div class="stat-label">–î–Ω—ñ–≤ —É —Ñ–µ–¥–µ—Ä–∞—Ü—ñ—ó</div>
                    </div>
                </div>
            </div>
            {% endif %}
        {% else %}
            <!-- –î–ª—è —Å—Ç–∞—Ä—ã—Ö –ø–∏–ª–æ—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É -->
            <div class="pilot-stats">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ pilot.points }}</div>
                        <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –æ—á–∫–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ achievements|length }}</div>
                        <div class="stat-label">–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            {% set rank = 1 %}
                            {% if pilot.category == 'strike' %}
                                {% for p in all_strike_pilots %}
                                    {% if p.id == pilot.id %}{{ loop.index }}{% endif %}
                                {% endfor %}
                            {% else %}
                                {% for p in all_recon_pilots %}
                                    {% if p.id == pilot.id %}{{ loop.index }}{% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="stat-label">–ú—ñ—Å—Ü–µ –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ days_in_federation }}</div>
                        <div class="stat-label">–î–Ω—ñ–≤ —É —Ñ–µ–¥–µ—Ä–∞—Ü—ñ—ó</div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
        <div class="profile-navigation">
            <a href="{{ url_for('rating') }}" class="btn btn-secondary">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Ä–µ–π—Ç–∏–Ω–≥—É</a>
        </div>
    </div>
</section>

<style>
.pilot-id-card {
    background: var(--card-gradient);
    border: 2px solid var(--border-success);
    border-radius: 12px;
    padding: var(--spacing-md);
    margin-top: var(--spacing-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 400px;
    transition: all 0.3s ease;
}

.pilot-id-card.inactive {
    border-color: var(--text-danger);
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
    box-shadow: 0 4px 8px rgba(220, 53, 69, 0.2);
}

.id-info {
    flex: 1;
}

.pilot-id-number {
    font-size: var(--font-lg);
    font-weight: 700;
    color: var(--text-success);
    font-family: var(--font-mono);
    margin-bottom: var(--spacing-xs);
}

.id-status {
    color: var(--text-success);
    font-size: var(--font-sm);
    font-weight: 500;
    text-transform: uppercase;
    transition: color 0.3s ease;
}

.id-status.inactive {
    color: var(--text-danger);
}

.qr-mini {
    flex-shrink: 0;
    margin-left: var(--spacing-md);
}

.qr-mini iframe {
    border-radius: 4px;
    background: white;
    overflow: hidden;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .pilot-id-card {
        flex-direction: column;
        text-align: center;
        max-width: 100%;
    }
    
    .qr-mini {
        margin-left: 0;
        margin-top: var(--spacing-md);
    }
}

.qr-section {
    margin: var(--spacing-2xl) 0;
}

.qr-container {
    text-align: center;
    margin: var(--spacing-lg) 0;
}

.qr-link {
    text-align: center;
    color: var(--text-tertiary);
    margin-top: var(--spacing-md);
}

.achievements-list {
    margin-top: var(--spacing-lg);
}

.achievement-item {
    background: var(--card-gradient);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.achievement-item:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-card);
}

.achievement-description {
    font-weight: 500;
    margin-bottom: var(--spacing-xs);
}

.achievement-date {
    color: var(--text-tertiary);
    font-size: var(--font-sm);
}

.achievement-points {
    color: var(--text-success);
    font-weight: 700;
    font-size: var(--font-lg);
}

.no-achievements {
    text-align: center;
    padding: var(--spacing-2xl);
    color: var(--text-tertiary);
}

.pilot-stats {
    margin: var(--spacing-2xl) 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
    margin-top: var(--spacing-lg);
}

.stat-card {
    background: var(--card-gradient);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: var(--spacing-lg);
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-card);
}

.stat-value {
    font-size: var(--font-3xl);
    font-weight: 700;
    color: var(--text-success);
    margin-bottom: var(--spacing-sm);
}

.stat-label {
    color: var(--text-secondary);
    font-size: var(--font-sm);
}

.profile-navigation {
    margin-top: var(--spacing-2xl);
    text-align: center;
}

@media (max-width: 768px) {
    .pilot-header {
        flex-direction: column;
        text-align: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}
