{% extends "base.html" %}

{% block title %}–†–µ–π—Ç–∏–Ω–≥ –ø—ñ–ª–æ—Ç—ñ–≤ - –í—Å–µ—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ —Ñ–µ–¥–µ—Ä–∞—Ü—ñ—è –≤—ñ–π—Å—å–∫–æ–≤–∏—Ö –ø—ñ–ª–æ—Ç—ñ–≤ –ë–ü–õ–ê{% endblock %}

{% block content %}
<section class="rating-section">
    <div class="container">
        <h1 class="text-center mb-xl">–†–µ–π—Ç–∏–Ω–≥ –ø—ñ–ª–æ—Ç—ñ–≤ –ë–ü–õ–ê</h1>
        
        <!-- –ü–æ–∏—Å–∫ -->
        <div class="rating-search">
            <input type="text" 
                   id="ratingSearch" 
                   placeholder="–ü–æ—à—É–∫ –∑–∞ ID –∞–±–æ –ø–æ–∑–∏–≤–Ω–∏–º..." 
                   class="rating-search-input">
            <div class="rating-search-icon">üîç</div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π -->
        <div class="rating-tabs">
            <button class="tab-button active" onclick="showTable('all')">–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</button>
            <button class="tab-button" onclick="showTable('strike')">–£–¥–∞—Ä–Ω—ñ –ø—ñ–ª–æ—Ç–∏</button>
            <button class="tab-button" onclick="showTable('reconnaissance')">–†–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω—ñ –ø—ñ–ª–æ—Ç–∏</button>
        </div>

        <!-- –ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ -->
        <div id="table-all" class="table-container">
            <table class="rating-table">
                <thead>
                    <tr>
                        <th>–ú—ñ—Å—Ü–µ</th>
                        <th>ID</th>
                        <th>–ü–æ–∑–∏–≤–Ω–∏–π</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
                        <th>–î–∞—Ç–∞ –≤—Å—Ç—É–ø—É</th>
                        <th>–û—á–∫–∏</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pilot in all_pilots %}
                    <tr>
                        <td><span class="pilot-rank">#{{ loop.index }}</span></td>
                        <td><span class="pilot-id-badge">{{ pilot.pilot_id }}</span></td>
                        <td>
                            <div class="pilot-cell">
                                <img src="{{ url_for('static', filename='images/' + pilot.photo_url) }}" 
                                     alt="{{ pilot.callsign }}" 
                                     class="pilot-avatar-small"
                                     onerror="this.src='{{ url_for('static', filename='images/default-pilot.svg') }}'">
                                <span>{{ pilot.callsign }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="pilot-category category-{{ pilot.category }}">
                                {% if pilot.category == 'strike' %}–£–¥–∞—Ä–Ω–∏–π{% else %}–†–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω–∏–π{% endif %}
                            </span>
                        </td>
                        <td>{{ pilot.join_date.strftime('%d.%m.%Y') }}</td>
                        <td><strong>{{ pilot.points }}</strong></td>
                        <td>
                            <a href="{{ url_for('pilot_profile', qr_code=pilot.qr_code) }}" class="btn btn-secondary btn-sm">–ü—Ä–æ—Ñ—ñ–ª—å</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –£–¥–∞—Ä–Ω—ñ –ø—ñ–ª–æ—Ç–∏ -->
        <div id="table-strike" class="table-container" style="display: none;">
            <table class="rating-table">
                <thead>
                    <tr>
                        <th>–ú—ñ—Å—Ü–µ</th>
                        <th>ID</th>
                        <th>–ü–æ–∑–∏–≤–Ω–∏–π</th>
                        <th>–î–∞—Ç–∞ –≤—Å—Ç—É–ø—É</th>
                        <th>–û—á–∫–∏</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pilot in strike_pilots %}
                    <tr>
                        <td><span class="pilot-rank">#{{ loop.index }}</span></td>
                        <td><span class="pilot-id-badge">{{ pilot.pilot_id }}</span></td>
                        <td>
                            <div class="pilot-cell">
                                <img src="{{ url_for('static', filename='images/' + pilot.photo_url) }}" 
                                     alt="{{ pilot.callsign }}" 
                                     class="pilot-avatar-small"
                                     onerror="this.src='{{ url_for('static', filename='images/default-pilot.svg') }}'">
                                <span>{{ pilot.callsign }}</span>
                            </div>
                        </td>
                        <td>{{ pilot.join_date.strftime('%d.%m.%Y') }}</td>
                        <td><strong>{{ pilot.points }}</strong></td>
                        <td>
                            <a href="{{ url_for('pilot_profile', qr_code=pilot.qr_code) }}" class="btn btn-secondary btn-sm">–ü—Ä–æ—Ñ—ñ–ª—å</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –†–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω—ñ –ø—ñ–ª–æ—Ç–∏ -->
        <div id="table-reconnaissance" class="table-container" style="display: none;">
            <table class="rating-table">
                <thead>
                    <tr>
                        <th>–ú—ñ—Å—Ü–µ</th>
                        <th>ID</th>
                        <th>–ü–æ–∑–∏–≤–Ω–∏–π</th>
                        <th>–î–∞—Ç–∞ –≤—Å—Ç—É–ø—É</th>
                        <th>–û—á–∫–∏</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pilot in recon_pilots %}
                    <tr>
                        <td><span class="pilot-rank">#{{ loop.index }}</span></td>
                        <td><span class="pilot-id-badge">{{ pilot.pilot_id }}</span></td>
                        <td>
                            <div class="pilot-cell">
                                <img src="{{ url_for('static', filename='images/' + pilot.photo_url) }}" 
                                     alt="{{ pilot.callsign }}" 
                                     class="pilot-avatar-small"
                                     onerror="this.src='{{ url_for('static', filename='images/default-pilot.svg') }}'">
                                <span>{{ pilot.callsign }}</span>
                            </div>
                        </td>
                        <td>{{ pilot.join_date.strftime('%d.%m.%Y') }}</td>
                        <td><strong>{{ pilot.points }}</strong></td>
                        <td>
                            <a href="{{ url_for('pilot_profile', qr_code=pilot.qr_code) }}" class="btn btn-secondary btn-sm">–ü—Ä–æ—Ñ—ñ–ª—å</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<style>
.pilot-cell {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.pilot-avatar-small {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--border-primary);
    object-fit: cover;
}

.btn-sm {
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: var(--font-sm);
}

.table-container {
    margin-top: var(--spacing-xl);
}

.pilot-id-badge {
    background: var(--accent-gradient);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-family: var(--font-mono);
    font-size: var(--font-xs);
    font-weight: 600;
}

/* –ü–æ–∏—Å–∫ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ */
.rating-search {
    position: relative;
    max-width: 400px;
    margin: 0 auto var(--spacing-xl) auto;
}

.rating-search-input {
    width: 100%;
    padding: 12px 40px 12px 16px;
    background: var(--card-gradient);
    border: 1px solid var(--border-primary);
    border-radius: 25px;
    color: var(--text-primary);
    font-size: var(--font-sm);
    transition: all 0.3s ease;
    text-align: center;
}

.rating-search-input:focus {
    outline: none;
    border-color: var(--border-accent);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    text-align: left;
}

.rating-search-input::placeholder {
    color: var(--text-tertiary);
}

.rating-search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    font-size: 14px;
    pointer-events: none;
}

/* –°–∫—Ä—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ */
.rating-table tbody tr.hidden {
    display: none;
}

.no-results {
    text-align: center;
    padding: var(--spacing-2xl);
    color: var(--text-tertiary);
    display: none;
}
</style>

<script>
let currentTable = 'all';

function showTable(category) {
    currentTable = category;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    document.querySelectorAll('.table-container').forEach(table => {
        table.style.display = 'none';
    });
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    document.getElementById('table-' + category).style.display = 'block';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
    event.target.classList.add('active');
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫ –∫ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ
    const searchValue = document.getElementById('ratingSearch').value;
    if (searchValue) {
        filterTable(searchValue);
    }
}

function filterTable(query) {
    const activeTable = document.getElementById('table-' + currentTable);
    const rows = activeTable.querySelectorAll('tbody tr');
    let visibleCount = 0;
    
    query = query.toLowerCase();
    
    rows.forEach(row => {
        const pilotId = row.querySelector('.pilot-id-badge')?.textContent.toLowerCase() || '';
        const callsign = row.querySelector('.pilot-cell span')?.textContent.toLowerCase() || '';
        
        if (pilotId.includes(query) || callsign.includes(query) || query === '') {
            row.classList.remove('hidden');
            visibleCount++;
        } else {
            row.classList.add('hidden');
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
    let noResultsMsg = activeTable.querySelector('.no-results');
    if (!noResultsMsg) {
        noResultsMsg = document.createElement('div');
        noResultsMsg.className = 'no-results';
        noResultsMsg.textContent = '–ü—ñ–ª–æ—Ç—ñ–≤ –∑–∞ –∑–∞–ø–∏—Ç–æ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
        activeTable.appendChild(noResultsMsg);
    }
    
    noResultsMsg.style.display = (visibleCount === 0 && query !== '') ? 'block' : 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('ratingSearch');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            filterTable(query);
        }, 300);
    });
});
</script>
{% endblock %}
